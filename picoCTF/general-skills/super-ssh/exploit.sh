#!/bin/bash

usage() {
    echo "Usage: $0 -u <user> -d <hostname> -p <port> -pwd <password>"
    exit 1
}

# Initialize variables
destination=""
username=""
port=""
password=""

# Parse command-line options
while [[ "$#" -gt 0 ]]; do
	case "$1" in
		-d)
			destination="$2"
			shift 2
			;;
		-u)
			username="$2"
			shift 2
			;;	
		-p)
			port="$2"
			shift 2
			;;
		-pwd)
			password="$2"
			shift 2
			;;
		*)
			echo "Unknown option: $1"
			usage
			;;
	esac
done

# Check if all required arguments are provided
if [[ -z "$destination" || -z "$username" || -z "$port" || -z "$password" ]]; then
	echo "Error: Missing required arguments."
    usage
fi

function get_flag() {
	sshpass -p "$password" ssh -o StrictHostKeyChecking=no "$username@$destination" -p "$port" 2>&1 | grep -v 'Connection to .* closed' | cut -d ':' -f 2
}

echo "$(get_flag)"