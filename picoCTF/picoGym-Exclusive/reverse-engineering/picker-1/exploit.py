from pwn import *
import argparse


def get_port():
    parser = argparse.ArgumentParser()
    parser.add_argument("port", help="The netcat port")
    arg = parser.parse_args()
    return arg.port


def send_command(conn, command):
    conn.sendline(command)
    response = conn.recv()
    return response.decode("utf-8")


def get_flag(conn):
    command = 'win'.encode("utf-8")
    response = send_command(conn, command)
    print(f"Response: {response}")

    response_lines = response.split('\n')
    hex_string = str(response_lines[1].replace("==>", ""))
    cleaned_hex = hex_string.replace("0x", "").replace(" ", "")
    byte_data = bytes.fromhex(cleaned_hex)
    decoded_string = byte_data.decode('utf-8')

    return decoded_string


if __name__ == "__main__":
    server = 'saturn.picoctf.net'
    port = get_port()
    conn = remote(server, port)
    try:
        flag = get_flag(conn)
        print("-"*50)
        print(f"Flag: {flag}")
        print("-"*50)
    except Exception as e:
        print(f"An error occured: {e}")
        print("Try couple of time, or restart the instance and then run again!!!")
    finally:
        conn.close()
